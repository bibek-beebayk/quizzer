{% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/auth.css' %}">

<div class="auth-container">
    <div class="auth-card wide">
        <div class="auth-header">
            <h2>Join quizNfacts</h2>
            <p>Create an account to start exploring</p>
        </div>

        <form method="POST" action="{% url 'register' %}" id="registrationForm">
            {% csrf_token %}

            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="alert {{ message.tags }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% if form.errors %}
            <div class="alert error">
                Please correct the errors below.
            </div>
            {% endif %}

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" class="form-control" required>
                {% if form.email.errors %}
                <div class="error-message">{{ form.email.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" class="form-control" required>
                {% if form.password.errors %}
                <div class="error-message">{{ form.password.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label for="password2">Confirm Password</label>
                <input type="password" id="password2" name="password2" class="form-control" required>
                <div id="passwordMatchError" class="error-message" style="display: none;">Passwords do not match</div>
                {% if form.password2.errors %}
                <div class="error-message">{{ form.password2.errors }}</div>
                {% endif %}
            </div>

            <div class="form-group">
                <label>Choose Your Interests (select at least 3)</label>
                <div class="interests-grid">
                    {% for interest in interests %}
                    <label class="interest-option">
                        <input type="checkbox" name="interests" value="{{ interest.id }}"
                            id="interest_{{ interest.id }}">
                        <span>{{ interest.name }}</span>
                    </label>
                    {% endfor %}
                </div>
                <div id="interestsError" class="error-message" style="display: none;">
                    Please select at least 3 interests.
                </div>
            </div>

            <button type="submit" class="btn btn-primary w-100"
                style="width: 100%; padding: 12px; margin-top: 10px;">Create Account</button>
        </form>

        <div class="auth-footer">
            Already have an account? <a href="{% url 'login' %}">Sign In</a>
        </div>
    </div>
</div>

<script>
    document.getElementById('registrationForm').addEventListener('submit', function (e) {
        const checkedInterests = document.querySelectorAll('input[name="interests"]:checked');
        const interestsError = document.getElementById('interestsError');
        const password = document.getElementById('password').value;
        const password2 = document.getElementById('password2').value;
        const passwordMatchError = document.getElementById('passwordMatchError');

        // Validate password match
        if (password !== password2) {
            e.preventDefault();
            passwordMatchError.style.display = 'block';
            return false;
        } else {
            passwordMatchError.style.display = 'none';
        }

        if (checkedInterests.length < 3) {
            e.preventDefault();
            interestsError.style.display = 'block';
            return false;
        }

        interestsError.style.display = 'none';
        return true;
    });

    // Highlight selected interests
    const interestOptions = document.querySelectorAll('.interest-option');
    interestOptions.forEach(option => {
        const checkbox = option.querySelector('input[type="checkbox"]');

        // Initial check
        if (checkbox.checked) option.classList.add('selected');

        checkbox.addEventListener('change', function () {
            if (this.checked) {
                option.classList.add('selected');
            } else {
                option.classList.remove('selected');
            }
        });
    });
</script>
{% endblock %}