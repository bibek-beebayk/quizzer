{% extends "base.html" %}
{% load static %}

{% block header %}
<link rel="stylesheet" type="text/css" href="{% static 'css/register.css' %}">
{% endblock %}

{% block content %}

<div class="registration-container">
    <h2 style="margin-bottom: 30px;">Create New Account</h2>

    <form class="registration-form" method="POST" action="{% url 'register' %}" id="registrationForm">
        {% csrf_token %}

        {% if form.errors %}
        <div class="error-message">
            Please correct the errors below.
        </div>
        {% endif %}

        {% if messages %}
        <div class="error-message">

            {% for message in messages %}
            <div class="alert {{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" required>
            {% if form.email.errors %}
            <div class="error-message">{{ form.email.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required>
            {% if form.password.errors %}
            <div class="error-message">{{ form.password.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="password2">Confirm Password</label>
            <input type="password" id="password2" name="password2" required>
            {% if form.password2.errors %}
            <div class="error-message">{{ form.password2.errors }}</div>
            {% endif %}
        </div>

        <div class="form-group">
            <label>Choose Your Interests (select at least 3)</label>
            <div class="interests-grid">
                {% for interest in interests %}
                <div class="interest-option">
                    <input type="checkbox" name="interests" value="{{ interest.id }}" id="interest_{{ interest.id }}">
                    <label for="interest_{{ interest.id }}">{{ interest.name }}</label>
                </div>
                {% endfor %}
            </div>
            <div id="interestsError" class="error-message" style="display: none;">
                Please select at least 3 interests.
            </div>
        </div>

        <button type="submit" class="submit-btn">Create Account</button>
    </form>
</div>

<script>
    document.getElementById('registrationForm').addEventListener('submit', function (e) {
        const checkedInterests = document.querySelectorAll('input[name="interests"]:checked');
        const interestsError = document.getElementById('interestsError');
        const password = document.getElementById('password').value;
        const password2 = document.getElementById('password2').value;
        const passwordError = document.getElementById('passwordError');

        // Add a password match error message div in the HTML
        let passwordMatchError = document.getElementById('passwordMatchError');
        if (!passwordMatchError) {
            passwordMatchError = document.createElement('div');
            passwordMatchError.id = 'passwordMatchError';
            passwordMatchError.className = 'error-message';
            document.querySelector('input[name="password2"]').parentNode.appendChild(passwordMatchError);
        }

        // Validate password match
        if (password !== password2) {
            e.preventDefault();
            passwordMatchError.textContent = 'Passwords do not match';
            passwordMatchError.style.display = 'block';
            return false;
        } else {
            passwordMatchError.style.display = 'none';
        }

        if (checkedInterests.length < 3) {
            e.preventDefault();
            interestsError.style.display = 'block';
            return false;
        }

        interestsError.style.display = 'none';
        console.log('Form submitted', checkedInterests);
        return true;
    });

    // Highlight selected interests
    const interestOptions = document.querySelectorAll('.interest-option');
    interestOptions.forEach(option => {
        const checkbox = option.querySelector('input[type="checkbox"]');
        checkbox.addEventListener('change', function () {
            if (this.checked) {
                option.classList.add('selected');
            } else {
                option.classList.remove('selected');
            }
        });
    });
</script>
{% endblock %}