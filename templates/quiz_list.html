{% extends "base.html" %}
{% load static %}

{% block meta %}
<link rel="stylesheet" type="text/css" href="{% static 'css/quiz_list.css' %}">
<title>quizNfacts | Quizzes</title>
{% endblock %}

{% block content %}
<div class="quiz-container">
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert {{ message.tags }}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="section-header">
        <h2>Available Quizzes</h2>
    </div>

    <form method="get" class="category-filters">
        <select name="category" onchange="this.form.submit()">
            <option value="">All Categories ({{total_quiz_count}})</option>
            {% for category in categories %}
            <option value="{{ category.id }}" {% if request.GET.category|stringformat:'s' == category.id|stringformat:'s' %}selected{% endif %}>
                {{ category.name }} ({{ category.quizzes.count }})
            </option>
            {% endfor %}
        </select>

        <select name="taken" onchange="this.form.submit()">
            <option value="">Status: All</option>
            <option value="taken" {% if request.GET.taken == "taken" %}selected{% endif %}>Already Taken</option>
            <option value="not-taken" {% if request.GET.taken == "not-taken" %}selected{% endif %}>Not Taken</option>
        </select>
    </form>

    <div class="quiz-list">
        {% for quiz in quizzes %}
        <div class="quiz-card">
            <div class="quiz-details">
                <h3>{{ quiz.name }}</h3>
                <p>
                    <i class="fas fa-question-circle"></i> {{ quiz.questions.count }}
                    {% if quiz.questions.count == 1 %}Question{% else %}Questions{% endif %}
                </p>
                {% if quiz.category %}
                <p><i class="fas fa-tag"></i> {{ quiz.category.name }}</p>
                {% endif %}
            </div>
            <div class="quiz-meta">
                {% if quiz.is_taken %}
                <div class="alert success" style="margin: 0; padding: 5px;">
                    Score: {{quiz.user_score_percentage}}%
                </div>
                {% else %}
                <a href="/quiz?quiz={{quiz.id}}" class="take-quiz-btn">Start Quiz</a>
                {% endif %}
                <p><i class="far fa-calendar-alt"></i> Added: {{ quiz.publish_at|date:"M d, Y" }}</p>
            </div>
        </div>

        {% empty %}
        <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--color-text-secondary);">
            <h3>No quizzes found.</h3>
            <p>Try changing the filters.</p>
        </div>
        {% endfor %}
    </div>

    <!-- Pagination Controls -->
    {% if quizzes.has_other_pages %}
    <div class="pagination">
        {% if quizzes.has_previous %}
        <a href="?page=1{% if category_id %}&category={{ category_id }}{% endif %}">&laquo; First</a>
        <a
            href="?page={{ quizzes.previous_page_number }}{% if category_id %}&category={{ category_id }}{% endif %}">Previous</a>
        {% endif %}

        <span class="current-page">
            Page {{ quizzes.number }} of {{ quizzes.paginator.num_pages }}
        </span>

        {% if quizzes.has_next %}
        <a
            href="?page={{ quizzes.next_page_number }}{% if category_id %}&category={{ category_id }}{% endif %}">Next</a>
        <a href="?page={{ quizzes.paginator.num_pages }}{% if category_id %}&category={{ category_id }}{% endif %}">Last
            &raquo;</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}